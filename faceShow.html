<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>九联人脸识别系统</title>
    <script src="js/adapt.js"></script>
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/font.css">
    <link rel="stylesheet" href="css/face.css">
</head>
<body>
<div class="contain">
    <div class="head" onclick="test()">
        UNIONMAN
    </div>
    <div class="middle">
        <div class="left" id="vs-left">
            <div class="compare-item">
                <div class="left-item">
                    <img src="image/222.jpg">
                </div>
                <div class="right-item">
                    <div class="text">姓 名：张艺兴</div>
                    <div class="text">性 别：男</div>
                    <div class="text">部 门：研发中心</div>
                    <div class="text">魅力值：80%</div>
                    <div class="text">欢乐值：80%</div>
                </div>

            </div>
        </div>
        <div class="center"></div>
        <div class="right" id="vs-right">
            <div class="compare-item">
                <div class="left-item">
                    <div class="text">明星：刘诗诗</div>
                </div>
                <div class="right-item">

                    <img src="image/33.jpg">
                </div>
            </div>
        </div>
    </div>
    <div class="info">
        <div class="percent">相似度：<span id="percent">80%</span></div>
        <div class="text" id="re-info">该不会失散多年</div>
    </div>
    <div class="bottom">
        <div class="nav" id="nav">
            <!--  <div class="item">
                  <div class="left-item">
                      <div class="text">
                          <div class="text-item">姓名</div>
                          <div class="text-item">性别</div>
                          <div class="text-item">萌新抵达</div>
                          <div class="text-item">本月抵达</div>
                      </div>

                  </div>
                  <div class="right-item">
                      <img src="image/222.jpg">
                  </div>
              </div>
              <div class="item">
                  <div class="left-item">
                      <div class="text">
                          <div class="text-item">姓名</div>
                          <div class="text-item">性别</div>
                          <div class="text-item">萌新抵达</div>
                          <div class="text-item">本月抵达</div>
                      </div>

                  </div>
                  <div class="right-item">
                      <img src="image/222.jpg">
                  </div>
              </div>
              <div class="item">
                  <div class="left-item">
                      <div class="text">
                          <div class="text-item">姓名</div>
                          <div class="text-item">性别</div>
                          <div class="text-item">萌新抵达</div>
                          <div class="text-item">本月抵达</div>
                      </div>

                  </div>
                  <div class="right-item">
                      <img src="image/222.jpg">
                  </div>
              </div>
              <div class="item">
                  <div class="left-item">
                      <div class="text">
                          <div class="text-item">姓名</div>
                          <div class="text-item">性别</div>
                          <div class="text-item">萌新抵达</div>
                          <div class="text-item">本月抵达</div>
                      </div>

                  </div>
                  <div class="right-item">
                      <img src="image/222.jpg">
                  </div>
              </div>-->
        </div>
    </div>
</div>

<div class="effect" id="bg" >

</div>


</body>
<script src="js/jquery-1.8.3.min.js"></script>
<script src="js/websocket/stomp.min.js"></script>
<script src="js/websocket/sockjs.min.js"></script>
<script src="js/effects.js"></script>
<script src="js/ajaxRequest.js"></script>
<script>
    var host = 'http://127.0.0.1:8080';
    //start/{id}
    var id = 3
    var startTaskUrl = host + "/start/" + id;
    var stoptTaskUrl = host + "/stop/" + id;
    var nick = ['', '吾皇驾到', '萌新抵达'];

    window.onload = function () {
     //   startTask();
    }

    function startTask() {
        ajaxGet(startTaskUrl, function (data) {
            console.info('任务开启成功');
            var timer=setTimeout(function () {
              wsSoketConnect();
              clearTimeout(timer);
            },1000)
        })
    }

    function wsSoketConnect() {
        var socket = new SockJS(host + '/endpointWarning');
        var stompClient = Stomp.over(socket);
        var connectCallback = function () {
            console.info('face websocket 开启');
            stompClient.subscribe('/topic/getShow', function (response) {
                console.info('mess',JSON.parse(response.body));
                var info=JSON.parse(response.body);
                insertVsInfo(info);
                insertItem( info);
            });
        }
        var errorCallback = function () {
            console.info('websocket 关闭');
            connect();
        }

        stompClient.connect({}, connectCallback, errorCallback);
    }

    function test() {
        te++;
        var info = {
            'resemble': '80%',
            'reInfo': '该不会是失散多年得兄弟吧',
            'person': {
                'alertFlag':true,
                'workPic': 'image/222.jpg',
                'lifePic': 'image/222.jpg',
                "name": '张艺兴' + te,
                'sex': '男',
                'department': '研发中心',
                'time': '8:00:00',
                'monCount': '30',
                'charming': '80',
                'happy': '90',
                'luck': '桃花旺盛'
            },
            'star': {
                "picUrl": 'image/222.jpg',
                "name": '张艺兴'
            }
        };
        insertVsInfo( info);
        insertItem( info);
    }


    var te = 0;
    var um='um';
    function insertVsInfo(info) {

        var div = '';
        var dom = $('#vs-left');
        if (info.person.alertFlag) {

            div = '<div class="compare-item">\n' +
                '                <div class="left-item">\n' +
                '                    <img src="' + info.person.workPic + '">\n' +
                '                </div>\n' +
                '                <div class="right-item">\n' +
                '                    <div class="text">姓  名：' + info.person.name + '</div>\n' +
                '                    <div class="text">性  别：' + info.person.sex + '</div>\n' +
                '                    <div class="text">部  门：' + info.person.department + '</div>\n' +
                '                    <div class="text">魅力值：' + info.person.charming + '</div>\n' +
                '                    <div class="text">欢乐值：' + info.person.happy + '</div>\n' +
                '                </div>\n' +
                '            </div>'


        } else {

            div = '<div class="compare-item">\n' +
                '                <div class="left-item">\n' +
                '                    <img src="data:image/png;base64,'+info.person.grabPic+'">\n' +
                '                </div>\n' +
                '                <div class="visit-item">\n' +
                '                    <div class="text">姓  名： 访客</div>\n' +
                '                    <div class="text">性  别：' + info.person.sex + '</div>\n' +
                '                    <div class="text">魅力值：' + info.person.charming + '</div>\n' +
                '                    <div class="text">欢乐值：' + info.person.happy + '</div>\n' +
                '                </div>\n' +
                '            </div>'
        }

        dom.empty();
        dom.append(div);


        dom = $('#vs-right');
        div = '  <div class="compare-item">\n' +
            '                <div class="left-item">\n' +
            '                    <div class="text">' + info.star.name + '</div>\n' +
            '                </div>\n' +
            '                <div class="right-item">\n' +
            '\n' +
            '                    <img src="' + info.star.picUrl + '">\n' +
            '                </div>\n' +
            '            </div>'

        dom.empty();
        dom.append(div);
        $('#percent').text(info.resemble);
        $('#re-info').text(info.reInfo);
        dom = $('#bg');
        var index=te%18;
        if(!info.person.alertFlag){

            div = ' <div  class="' + effects[index].class + '" ></div>\n'+
                '<div class="'+effects[index].child+'"></div>'
        }else {
            var m = Math;
         //   index = m.floor(m.random() * 18 + 1);
            div = ' <div  class="' + effects[index].class + '" ></div>\n'
        }
        dom.empty();
        dom.append(div);

    }

    function insertItem(info) {

        var m = Math;
        var index = m.floor(m.random() * 2 + 1);
        var pic = null;
        if (info.person.lifePic&&info.person.lifePic!==null&&info.person.lifePic!=="") {
            pic = info.person.lifePic;
        } else {
            pic = info.person.workPic;
        }
        var dom = $('#nav');
        var div = '';
        if (info.person.alertFlag) {
            if(info.person.name!==um) {
                um = info.person.name;
                div = ' <div class="item">\n' +
                    '                <div class="left-item">\n' +
                    '                    <div class="text">\n' +
                    '                        <div class="text-item">姓名：' + info.person.name + '</div>\n' +
                    '                        <div class="text-item">性别：' + info.person.sex + '</div>\n' +
                    '                        <div class="text-item">' + nick[index] + '  ' + info.person.time + '</div>\n' +
                    '                        <div class="text-item">本月吃鸡：' + info.person.monCount + '</div>\n' +
                    '                    </div>\n' +
                    '                </div>\n' +
                    '                <div class="right-item">\n' +
                    '                    <img src="' + pic + '">\n' +
                    '                </div>\n' +
                    '            </div>';
            }
        } else {
            div = ' <div class="item">\n' +
                '                <div class="left-item">\n' +
                '                    <div class="text">\n' +
                '                        <div class="text-item">姓名：访客</div>\n' +
                '                        <div class="text-item">性别：' + info.person.sex + '</div>\n' +
                '                        <div class="text-item">魅力值:' + info.person.charming + '</div>\n' +
                '                        <div class="text-item">欢乐值：' + info.person.happy + '</div>\n' +
                '                    </div>\n' +
                '                </div>\n' +
                '                <div class="right-item">\n' +
                '                    <img src="data:image/png;base64,' + info.person.grabPic + '">\n' +
                '                </div>\n' +
                '            </div>';
        }
        if(div!==''){
            dom.append(div);
        }

        if (dom.find('.item').length > 4) {
            dom.addClass('animation');
            var timer = setTimeout(function () {
                dom.removeClass('animation');
                dom.find('.item').get(0).remove();
                timer = null;
            }, 0.4 * 1000)
        }

    }

</script>
</html>